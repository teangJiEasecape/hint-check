<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

        <!-- ìŠ¤íƒ€ì¼ -->
        <link rel="stylesheet" href="./style/style.css">
        <link rel="stylesheet" href="./style/font.css">

        <!-- ì—‘ì…€ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>

        <!-- ì•± ë“±ë¡ -->
        <link rel="manifest" href="/hint-check/manifest.json" />
        <meta name="theme-color" content="#000000" />
    </head>

    <body>
        <main>
            <section class="main-section">

                <div class="title">ì •ë‹µ í™•ì¸ê¸°</div>

                <div class="answer-div">
                    <input type="text" id="hintCode" placeholder="íŒíŠ¸ì½”ë“œ ì…ë ¥">
                    <input type="text" id="userAnswer" placeholder="ì •ë‹µ ì…ë ¥">
                    <button type="button" onclick="checkAnswer()">í™•ì¸</button>
                </div>

                <!-- ê´€ë¦¬ììš© ì—‘ì…€ ì—…ë¡œë“œ -->
                <input type="file" id="excelFile" />

            </section>

            <script>
                /* ì—‘ì…€ ì—…ë¡œë“œ â†’ íŒíŠ¸ì½”ë“œ-ì •ë‹µ ì €ì¥ */
                document.getElementById("excelFile").addEventListener("change", function (e) {
                    const file = e.target.files[0];
                    const reader = new FileReader();

                    reader.onload = function (event) {
                        const data = new Uint8Array(event.target.result);
                        const workbook = XLSX.read(data, { type: "array" });
                        const sheet = workbook.Sheets[workbook.SheetNames[0]];
                        const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                        const answerMap = {};

                        rows.forEach((row, index) => {
                            if (index === 0) return; // í—¤ë” ì œì™¸
                            if (row[0] && row[1]) {
                                const answer = row[1].toString()
                                    .replace(/\s/g, "")
                                    .replace(/[\/\-_]/g, "")
                                    .trim();
                                answerMap[row[0].toString().trim()] = answer;
                            }
                        });

                        localStorage.setItem("answerMap", JSON.stringify(answerMap));
                        alert("ì—‘ì…€ ì •ë‹µì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
                    };

                    reader.readAsArrayBuffer(file);
                });

                /* ì •ë‹µ íŒë³„ */
                function checkAnswer() {
                    const hintCode = document.getElementById("hintCode").value.trim();
                    const userAnswer = document
                        .getElementById("userAnswer")
                        .value
                        .replace(/\s/g, "")
                        .replace(/[\/\-_]/g, "")
                        .trim();

                    /* âœ… ê´€ë¦¬ì ëª¨ë“œ ì§„ì… */
                    if (hintCode === "admin" && userAnswer === "9132") {
                        document.getElementById("excelFile").style.display = "block";
                        alert("ğŸ”“ ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™”");
                        return;
                    }

                    const answerMap = JSON.parse(localStorage.getItem("answerMap"));

                    if (!answerMap) {
                        alert("ì—‘ì…€ íŒŒì¼ì„ ë¨¼ì € ì—…ë¡œë“œí•˜ì„¸ìš”!");
                        return;
                    }

                    if (!answerMap[hintCode]) {
                        alert("ğŸ™…â€â™€ï¸ì˜¤ë‹µì…ë‹ˆë‹¤");
                        return;
                    }

                    const correctAnswer = answerMap[hintCode];

                    if (correctAnswer === userAnswer) {
                        alert("ğŸ™†â€â™€ï¸ì •ë‹µì…ë‹ˆë‹¤");
                    } else {
                        alert("ğŸ™…â€â™€ï¸ì˜¤ë‹µì…ë‹ˆë‹¤");
                    }
                }

            </script>
        </main>
    </body>
</html>
